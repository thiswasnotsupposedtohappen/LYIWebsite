<!DOCTYPE html>
<html>

<head>
  <title>LightYear Industries</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0&icon_names=shopping_cart" />
  <link rel="icon" type="image/x-icon" href="images/titleicon.png" />
</head>

<body class="Body">
  <div class="TopRibbon">    
    <a href=""><img src="images/LYI 500x380.png" style = "width: 250px; height: 100px; object-fit: cover;"></a>
    <div><a class="TopRibbonText" href="index.html">Home</a></div>
    <div><a class="TopRibbonText" href="shop.html">Shop</a></div>
    <div><a class="TopRibbonText" href="career.html">Career</a></div>
    <div><a class="TopRibbonText" href="contact.html">Contact Us</a></div>
    <div><a class="TopRibbonText" href="cart.html"><span class="material-symbols-outlined" style="width: 100px; font-size: 50px;">shopping_cart</span></a></div>
  </div>

  <button class = "shop-manufacturingconfig-button" onclick="OnClickLoadDXF()">LoadDXF</button>

  <input type="file" id="fileInput" style="padding-left: 50px;"></input><br>

  <div id = "viewer" style="height: 500px; margin-top: 50px; border-style: solid; border-width: 2px; border-color: black;">
    <canvas></canvas>
  </div>

  <div class="consoleoutput">    
  </div>
  
</body>

<script src="wasm/LYIWebsite.js"></script>  
<script>  
class Drawing
{
  constructor()
  {
    this.type = undefined;
    this.geometrey = undefined;
  }
}
class Point
{
  constructor()
  {
    this.x=undefined;
    this.y=undefined;
  }
};
class Line
{
  constructor()
  {
    this.x1=undefined;
    this.y1=undefined;
    this.x2=undefined;
    this.y2=undefined;        
  }
};
class Arc
{
  constructor()
  {
    this.x=undefined;
    this.y=undefined;
    this.r=undefined;
    this.t1=undefined;        
    this.t2=undefined;        
  }
};
class Elliplse
{
};
class Spline
{
};
var drawing = undefined;
var drawinglength = undefined;

var viewer = document.getElementById("viewer");
var canvas = document.querySelector("canvas");
canvas.width = viewer.clientWidth;
canvas.height = viewer.clientHeight;
var ctx = canvas.getContext("2d");
var videobufferjs;
var videobufferwasm;

Module.onRuntimeInitialized = function() 
{
  console.log("WASM Loaded");
  InitVideo();  
};
addEventListener("resize", function() 
{
  InitVideo();
});

console.log("System Ready");

function InitVideo()
{
  canvas.width = viewer.clientWidth;
  canvas.height = viewer.clientHeight;
  var status = _InitizalizeVideo(canvas.width,canvas.height);
  if(status == 0)
  {    
    videobufferwasm = _GETvideo();
    videobufferjs = new Uint8ClampedArray(canvas.width*canvas.height*4);
    videobufferjs.set(HEAPU8.subarray(videobufferwasm,videobufferwasm+canvas.width*canvas.height*4));
    
    ctx.putImageData(new ImageData(videobufferjs,canvas.width,canvas.height),0,0);

    console.log(videobufferjs);
    console.log("Video Initialized");
    document.querySelector(".consoleoutput").innerHTML = "Video Initialized" + "<br>";
  }
  else
  {
    console.log("Video Initialization Failed");
    document.querySelector(".consoleoutput").innerHTML = "Video Initialization Failed" + "<br>";
  }
}

function GetVideo()
{
  videobufferwasm = _GETvideo();
  videobufferjs = new Uint8ClampedArray(canvas.width*canvas.height*4);
  videobufferjs.set(HEAPU8.subarray(videobufferwasm,videobufferwasm+canvas.width*canvas.height*4));
  
  ctx.putImageData(new ImageData(videobufferjs,canvas.width,canvas.height),0,0);

  console.log(videobufferjs);
  console.log("Video Buffer Updated");
  document.querySelector(".consoleoutput").innerHTML += "Video Buffer Updated" + "<br>";
}

function OnClickLoadDXF() 
{
  var fileInput = document.getElementById('fileInput');
  var file = fileInput.files[0];
  if (file) 
  {
    var reader = new FileReader();
    reader.onload = function(e) 
    {
      var stringdata = e.target.result;
      var data = new Uint8Array(new TextEncoder().encode(stringdata));
      var memory = _malloc(data.length);
      HEAPU8.set(data, memory);
      console.log("return = " + _LoadDXF(memory,data.length));
      console.log("drawing = " +_GETdrawing());
      console.log("drawinglength = "+_GETdrawinglength());
      
      var address = _GETdrawing();
      drawinglength =  _GETdrawinglength();
      drawing = new Array(_GETdrawinglength());//.fill(null).map(() => new Drawing());
      for(var i=0;i<drawinglength;i++)
      {
        drawing[i] = new Drawing;
        drawing[i].type = HEAPU32[address/4];
        switch(drawing[i].type)
        {
          case 1:
          {
            drawing[i].geometrey = new Point;
            drawing[i].geometrey.x = HEAPF64[address/8 + 1];
            drawing[i].geometrey.y = HEAPF64[address/8 + 2];
          }break;
          case 2:
          {
            drawing[i].geometrey = new Line;
            drawing[i].geometrey.x1 = HEAPF64[address/8 + 1];
            drawing[i].geometrey.y1 = HEAPF64[address/8 + 2];
            drawing[i].geometrey.x2 = HEAPF64[address/8 + 3];
            drawing[i].geometrey.y2 = HEAPF64[address/8 + 4];
          }break;
          case 3:
          {
            drawing[i].geometrey = new Arc;
            drawing[i].geometrey.x = HEAPF64[address/8 + 1];
            drawing[i].geometrey.y = HEAPF64[address/8 + 2];
            drawing[i].geometrey.r = HEAPF64[address/8 + 3];
            drawing[i].geometrey.t1 = HEAPF64[address/8 + 4];
            drawing[i].geometrey.t2 = HEAPF64[address/8 + 5];
          }break;
        }
        address += 64;
      }
      console.log(drawing);
      _free(memory);

      for(var i=0;i<drawinglength;i++)
      {
        var string = "Type:" + drawing[i].type + " ";
        switch(drawing[i].type)
        {
          case 1:
          {
            string += "Point: x=" + drawing[i].geometrey.x + " y=" + drawing[i].geometrey.y;
          }break;
          case 2:
          {
            string += "Line: x1=" + drawing[i].geometrey.x1 + " y1=" + drawing[i].geometrey.y1 + " x2=" + drawing[i].geometrey.x2 + " y2=" + drawing[i].geometrey.y2;
          }break;
          case 3:
          {
            string += "Arc: x=" + drawing[i].geometrey.x + " y=" + drawing[i].geometrey.y + " r=" + drawing[i].geometrey.r + " t1=" + drawing[i].geometrey.t1 + " t2=" + drawing[i].geometrey.t2;
          }break;
        }
        document.querySelector(".consoleoutput").innerHTML += string + "<br>";
      }
    
      if(_PaintDrawingToVideo())
        console.log("Drawing Paint Failed");
      else
        console.log("Drawing Painted");

      GetVideo();
    };
    reader.readAsText(file);
  } 
  else 
  {
    console.log("No file selected");
  }
}
</script>

</html>

<!--
BACKUP CODE
function InitVideo()
{
  canvas.width = viewer.clientWidth;
  canvas.height = viewer.clientHeight;
  var status = _InitizalizeVideo(canvas.width,canvas.height);
  if(status == 0)
  {    
    videobufferwasm = _GETvideo();
    videobufferjs = new Uint8ClampedArray(canvas.width*canvas.height*4);
    videobufferjs.set(HEAPU8.subarray(videobufferwasm,videobufferwasm+canvas.width*canvas.height*4));
    
    ctx.putImageData(new ImageData(videobufferjs,canvas.width,canvas.height),0,0);

    console.log(videobufferjs);
    console.log("Video Initialized");
  }
  else
  {
    console.log("Video Initialization Failed");
  }
}

BACKUP CODE

var ctx = canvas.getContext("2d");
ctx.translate(canvas.width/2,canvas.height/2);
ctx.scale(1,-1);
ctx.lineWidth = 2;
ctx.strokeStyle = "green";

Render();

function Render()
{
  ctx.clearRect(-canvas.width/2,-canvas.height/2,canvas.width,canvas.height);
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.lineTo(0,canvas.width/2);
  ctx.moveTo(0,0);
  ctx.lineTo(canvas.height/2,0);
  ctx.stroke();
}

addEventListener("resize", function() 
{
  canvas.width = viewer.clientWidth;
  canvas.height = viewer.clientHeight;
  console.log(viewer.clientWidth + " " + viewer.clientHeight);
  Render();
});
-->

